<!DOCTYPE html>
<html>
<head>
    <title>API 测试工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin: 10px 0;
        }
        input, button, textarea {
            padding: 8px;
            margin: 4px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
    </style>
</head>
<body>
    <h1>MilkyTea API 测试工具</h1>

    <h2>连接测试</h2>
    <button onclick="testConnection()">测试后端连接</button>
    <div id="connectionResult" class="result" style="display:none;"></div>

    <h2>注册测试</h2>
    <div class="form-group">
        <input type="text" id="regUsername" placeholder="用户名" value="testuser">
        <input type="text" id="regPhone" placeholder="手机号" value="13800138000">
        <input type="password" id="regPassword" placeholder="密码" value="test123456">
        <button onclick="testRegister()">测试注册</button>
    </div>
    <div id="registerResult" class="result" style="display:none;"></div>

    <h2>登录测试</h2>
    <div class="form-group">
        <input type="text" id="loginUsername" placeholder="用户名" value="testuser">
        <input type="password" id="loginPassword" placeholder="密码" value="test123456">
        <button onclick="testLogin()">测试登录</button>
    </div>
    <div id="loginResult" class="result" style="display:none;"></div>

    <script>
        const BASE_URL = 'http://localhost:8080';

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${isError ? 'error' : 'success'}`;
            element.textContent = JSON.stringify(data, null, 2);
        }

        async function testConnection() {
            try {
                const response = await fetch(`${BASE_URL}/swagger-ui.html`, {
                    method: 'GET',
                    mode: 'no-cors' // 避免CORS问题
                });
                showResult('connectionResult', {
                    status: '连接成功',
                    message: '后端服务正在运行',
                    timestamp: new Date().toISOString()
                });
            } catch (error) {
                showResult('connectionResult', {
                    status: '连接失败',
                    error: error.message,
                    suggestion: '请确认后端服务是否在 http://localhost:8080 运行'
                }, true);
            }
        }

        async function testRegister() {
            const username = document.getElementById('regUsername').value;
            const phone = document.getElementById('regPhone').value;
            const password = document.getElementById('regPassword').value;

            try {
                const response = await fetch(`${BASE_URL}/api/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username,
                        phone,
                        password
                    })
                });

                const data = await response.json();
                console.log('注册响应:', { status: response.status, data });

                if (response.ok) {
                    showResult('registerResult', {
                        status: '注册成功',
                        data: data
                    });
                } else {
                    showResult('registerResult', {
                        status: '注册失败',
                        httpStatus: response.status,
                        error: data
                    }, true);
                }
            } catch (error) {
                showResult('registerResult', {
                    status: '请求失败',
                    error: error.message
                }, true);
            }
        }

        async function testLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                console.log('发送登录请求:', { username, password });

                const response = await fetch(`${BASE_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username,
                        password
                    })
                });

                const data = await response.json();
                console.log('登录响应:', { status: response.status, data });

                if (response.ok) {
                    showResult('loginResult', {
                        status: '登录成功',
                        data: data
                    });
                } else {
                    showResult('loginResult', {
                        status: '登录失败',
                        httpStatus: response.status,
                        error: data
                    }, true);
                }
            } catch (error) {
                showResult('loginResult', {
                    status: '请求失败',
                    error: error.message
                }, true);
            }
        }
    </script>
</body>
</html>
